# –õ–æ–≥ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

## –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏

```
## [–î–ê–¢–ê] –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–°–∏–º–ø—Ç–æ–º—ã**: –ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–ª–∞
**–†–µ—à–µ–Ω–∏–µ**: –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª–∏
**–§–∞–π–ª—ã**: –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
**–í–µ—Ä—Å–∏—è**: –í –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
```

---

## [2025-01] –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –∫–ª–∏–∫–µ

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É–µ–º–æ–π –∫–∞—Ä—Ç–æ–π (–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏) —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –¥—É–±–ª–∏–∫–∞—Ç –∫–∞—Ä—Ç—ã.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ê–Ω–∏–º–∏—Ä—É–µ–º—ã–µ –∫–∞—Ä—Ç—ã –∏–º–µ–ª–∏ `opacity: 0`, –Ω–æ `pointer-events: auto`. –ö–ª–∏–∫ "–ø—Ä–æ—Ö–æ–¥–∏–ª" —á–µ—Ä–µ–∑ –Ω–µ–≤–∏–¥–∏–º—É—é –∫–∞—Ä—Ç—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –¥–≤–∞–∂–¥—ã.

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å `pointer-events-none` –∫ –∫–∞—Ä—Ç–∞–º —Å `isDragging` –∏–ª–∏ `isAnimating` –≤ Card.tsx.

```tsx
className={cn(
  isDragging && "opacity-0 pointer-events-none",
  isAnimating && "opacity-0 pointer-events-none"
)}
```

**–§–∞–π–ª—ã**: `client/src/components/solitaire/Card.tsx`
**–í–µ—Ä—Å–∏—è**: 4.59.21

---

## [2025-01] Tap –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ö–∞—Ä—Ç—ã –Ω–∞ –º–æ–±–∏–ª–∫–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å, –Ω–æ tap (–∫–ª–∏–∫) –Ω–µ —Ä–∞–±–æ—Ç–∞–ª.

**–ü—Ä–∏—á–∏–Ω–∞**: 
1. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `animatingCard` –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ–π
2. –ü–æ—Ä–æ–≥ tap/drag –±—ã–ª 5px ‚Äî —Å–ª–∏—à–∫–æ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ**: 
1. –£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ—Ä–æ–≥ tap/drag —Å 5px –¥–æ 15px –≤ useTouchDrag.ts
2. –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø–æ–ª–æ–∂–∏—Ç—å—Å—è –Ω–∞ pointer-events-none

**–§–∞–π–ª—ã**: 
- `client/src/hooks/useTouchDrag.ts`
- `client/src/components/solitaire/TableauColumn.tsx`

**–í–µ—Ä—Å–∏—è**: 4.59.22

---

## [2025-01] –í–æ–∑–≤—Ä–∞—Ç –∫–∞—Ä—Ç—ã –∏–∑ foundation –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∫–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ –≤ foundation –≤–æ–∑–≤—Ä–∞—â–∞–ª –µ—ë –Ω–∞ tableau. –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –Ω–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–í FoundationPile –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è `onTap` callback –≤ useTouchDrag hook.

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å `handleTap` callback –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `moveFoundationToTableau`.

**–§–∞–π–ª—ã**: `client/src/components/solitaire/FoundationPile.tsx`
**–í–µ—Ä—Å–∏—è**: 4.59.24

---

## [2025-01] –û—Ç–∫–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∑–µ–º–µ–ª—å—è –ø—Ä–∏ –∑–∞—Ä–∞–±–æ—Ç–∫–µ –ª–æ–ø–∞—Ç–∫–∏

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ª–æ–ø–∞—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≤–µ–Ω—Ç–∞ Dungeon Dig –æ—Ç–∫–∞—Ç—ã–≤–∞–ª–æ—Å—å ‚Äî –∏—Å—á–µ–∑–∞–ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ç–∞–π–ª—ã, –ª–æ–ø–∞—Ç–æ–∫ —Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –±–æ–ª—å—à–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É React state –∏ localStorage. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–π state.

**–†–µ—à–µ–Ω–∏–µ**: 
–°–¥–µ–ª–∞—Ç—å localStorage –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–∏—Ç–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ localStorage –ø–µ—Ä–µ–¥ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

**–§–∞–π–ª—ã**: `client/src/lib/liveops/dungeonDig/index.ts`
**–í–µ—Ä—Å–∏—è**: 4.58.x

---

## [2025-01] –ö–ª—é—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–ª–∏—Å—å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≤–µ–Ω—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Treasure Hunt –∏ —Ç—Ä–∞—Ç—ã –≤—Å–µ—Ö –∫–ª—é—á–µ–π, –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–∑–¥–∞–≤–∞–ª–∏—Å—å –∫–ª—é—á–∏.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ü—Ä–æ–≤–µ—Ä–∫–∞ `eventExpired` –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∞ –ø–æ–ª–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≤–µ–Ω—Ç–∞ (expired + keys spent).

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `!event.active && eventExpired` –ø–µ—Ä–µ–¥ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤.

**–§–∞–π–ª—ã**: `client/src/components/solitaire/GameBoard.tsx`
**–í–µ—Ä—Å–∏—è**: 4.56.x

---

## [2025-01] Popup –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–º Telegram

**–°–∏–º–ø—Ç–æ–º—ã**: 
–û–∫–Ω–æ "–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è" –æ–±—Ä–µ–∑–∞–ª–æ—Å—å —Å–Ω–∏–∑—É, –∫–Ω–æ–ø–∫–∞ –Ω–µ –±—ã–ª–∞ –≤–∏–¥–Ω–∞.

**–ü—Ä–∏—á–∏–Ω–∞**: 
Popup –Ω–µ –∏–º–µ–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –∏ –Ω–µ –±—ã–ª —Å–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º—ã–º.

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å `max-h-[85vh] overflow-y-auto` –∏ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

**–§–∞–π–ª—ã**: `client/src/components/solitaire/GameBoard.tsx`
**–í–µ—Ä—Å–∏—è**: 4.59.26

---

## [2025-01] –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–Ω–µ—Ç —Ö–æ–¥–æ–≤"

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ò–≥—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ "–Ω–µ—Ç —Ö–æ–¥–æ–≤", —Ö–æ—Ç—è –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É –∏–∑ foundation –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

**–ü—Ä–∏—á–∏–Ω–∞**: 
`getHint()` –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª foundation-to-tableau –∫–∞–∫ –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ö–æ–¥.

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –º–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É –∏–∑ foundation –∏ –µ—Å—Ç—å –ª–∏ –∫–∞—Ä—Ç–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –Ω–µ—ë.

**–§–∞–π–ª—ã**: `client/src/lib/stores/useSolitaire.tsx`
**–í–µ—Ä—Å–∏—è**: 4.59.25

---

## [2025-01] –ü—Ä–æ–ø–∞–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç –≤ auto-collect

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏ –∞–≤—Ç–æ-—Å–±–æ—Ä–µ –∫–∞—Ä—Ç—ã –ø—Ä–æ–ø–∞–¥–∞–ª–∏.

**–ü—Ä–∏—á–∏–Ω–∞**: 
Race condition: –∫–∞—Ä—Ç–∞ –¥–æ–±–∞–≤–ª—è–ª–∞—Å—å –≤ foundation –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏, –Ω–æ –º–æ–≥–ª–∞ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: 
–î–æ–±–∞–≤–∏—Ç—å `batchAutoCollectingCards` Set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ. –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –≤ source –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

**–§–∞–π–ª—ã**: `client/src/lib/stores/useSolitaire.tsx`
**–í–µ—Ä—Å–∏—è**: 4.59.23

---

## [2025-01] Z-index –∫–æ–Ω—Ñ–ª–∏–∫—Ç: –∫–Ω–æ–ø–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π –Ω–µ –≤–∏–¥–Ω–∞

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ö–Ω–æ–ø–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç popup Dungeon Dig.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ö–Ω–æ–ø–∫–∞ –∏–º–µ–ª–∞ `z-[60]`, popup ‚Äî `z-[9999]`.

**–†–µ—à–µ–Ω–∏–µ**: 
–£–≤–µ–ª–∏—á–∏—Ç—å z-index –∫–Ω–æ–ø–∫–∏ –¥–æ `z-[10001]`.

**–§–∞–π–ª—ã**: `client/src/components/solitaire/GameBoard.tsx`

---

## [2025-01] Daily Quests –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–±–µ–¥—ã

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–±–µ–¥—ã —Å—á—ë—Ç—á–∏–∫–∏ daily quests –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å, –Ω–æ –ø—Ä–∏ –≤—Ç–æ—Ä–æ–π –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–±–µ–¥–∞—Ö –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –Ω–∞ –º–µ—Å—Ç–µ.

**–ü—Ä–∏—á–∏–Ω–∞**: 
**Stale Closure** –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `updateDailyQuestsOnWin` –≤ `useWinFlow.ts`.

–§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `callbacks.dailyQuests` –Ω–∞–ø—Ä—è–º—É—é:
```typescript
const updateDailyQuestsOnWin = useCallback(() => {
  const { dailyQuests, setDailyQuests, ... } = callbacks;
  // dailyQuests –∑–¥–µ—Å—å ‚Äî "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–æ–µ" –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è callback
  const updatedQuests = dailyQuests.map(quest => { ... });
  setDailyQuests(updatedQuests);
}, [callbacks]);
```

–ü—Ä–æ–±–ª–µ–º–∞: `callbacks` ‚Äî –æ–±—ä–µ–∫—Ç, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –∏–∑ GameBoard. –•–æ—Ç—è –æ–±—ä–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dailyQuests`) –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ closure –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –∫ –º–æ–º–µ–Ω—Ç—É –≤—ã–∑–æ–≤–∞ callback.

**–†–µ—à–µ–Ω–∏–µ**: 
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **functional update** –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è:
```typescript
const updateDailyQuestsOnWin = useCallback(() => {
  const { setDailyQuests, setAcesCollected, addStars } = callbacks;
  
  // Functional update –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  setDailyQuests(prevQuests => {
    const updatedQuests = prevQuests.map(quest => {
      // ... –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    });
    return updatedQuests;
  });
}, [callbacks]);
```

**–§–∞–π–ª—ã**: `client/src/hooks/useWinFlow.ts`
**–í–µ—Ä—Å–∏—è**: 4.99.27

**–ü–æ—Ö–æ–∂–∏–µ —Ä–∏—Å–∫–∏ –≤ –∫–æ–¥–µ**:
- `proceedToDailyQuests`: —á–∏—Ç–∞–µ—Ç `callbacks.dailyQuests` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `allCompleted` ‚Äî –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç.–∫. —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç
- `proceedToCollectionsOrNewGame`: —á–∏—Ç–∞–µ—Ç `callbacks.collections` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç

**–ü—Ä–∞–≤–∏–ª–æ**: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ state –∏–∑ useCallback, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å functional update (`setState(prev => ...)`) –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏–∑ props/callbacks.

---

## [2025-02] –¢–∞–ø –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —Å–æ–∑–¥–∞—ë—Ç return animation –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—ã

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (Telegram WebView) —Ç–∞–ø—ã –ø–æ –∫–∞—Ä—Ç–∞–º tableau –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏. –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `performCardAction BLOCKED: card is animating` –¥–ª—è –í–°–ï–• –∫–∞—Ä—Ç, —Ö–æ—Ç—è –Ω–∏–∫–∞–∫–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–µ –±—ã–ª–æ.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ü—Ä–∏ —Ç–∞–ø–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ —Å–ª–µ–¥—É—é—â–∞—è —Ü–µ–ø–æ—á–∫–∞:
1. `onTouchStart` –≤—ã–∑—ã–≤–∞–µ—Ç `handleTouchStart` –∏–∑ `useTouchDrag` ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è "drag"
2. –ü—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –ø–∞–ª—å—Ü–∞ (–±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è) `handleGlobalTouchEnd` –≤—ã–∑—ã–≤–∞–ª `onDragEnd()`
3. `onDragEnd()` –≤ store —Å–æ–∑–¥–∞–≤–∞–ª **return animation** (–∞–Ω–∏–º–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–∞—Ä—Ç—ã –Ω–∞ –º–µ—Å—Ç–æ)
4. Return animation —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞ `animatingCard` –≤ store
5. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∞–ø–µ `performCardAction` –≤–∏–¥–µ–ª `animatingCard` –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
6. `animatingCard` –Ω–µ –æ—á–∏—â–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –±–ª–æ–∫–∏—Ä—É—è –í–°–ï –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–ø—ã

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–µ–±–∞**: –ù–∞ –≤–µ–±–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `onClick`, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –º—ã—à—å—é. –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `onTouchStart` + `useTouchDrag`, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –ª—é–±–æ–µ –∫–∞—Å–∞–Ω–∏–µ –∫–∞–∫ –Ω–∞—á–∞–ª–æ drag.

**–†–µ—à–µ–Ω–∏–µ**: 
1. –í `useTouchDrag.ts` –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `__isTapNotDrag`:
```typescript
if (!wasMoved) {
  (window as any).__isTapNotDrag = true;
  onDragEnd();
  delete (window as any).__isTapNotDrag;
  // ... –∑–∞—Ç–µ–º –≤—ã–∑–≤–∞—Ç—å onTap()
}
```

2. –í `useSolitaire.tsx` `endDrag` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ return animation:
```typescript
endDrag: () => {
  const isTapNotDrag = (window as any).__isTapNotDrag;
  if (isTapNotDrag) {
    // –ü—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º state –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
    set({ isDragging: false, draggedCards: [], ... });
    return;
  }
  // –ò–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë–º return animation –∫–∞–∫ –æ–±—ã—á–Ω–æ
}
```

**–§–∞–π–ª—ã**: 
- `client/src/hooks/useTouchDrag.ts`
- `client/src/lib/stores/useSolitaire.tsx`

**–í–µ—Ä—Å–∏—è**: 4.99.45

**–í–∞–∂–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**:
- –ú–æ–±–∏–ª—å–Ω—ã–µ touch —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∏–Ω–∞—á–µ —á–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ click —Å–æ–±—ã—Ç–∏—è
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –í–°–ï–• –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
- `onTouchStart` –Ω–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω `onClick` ‚Äî tap —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## [2025-02] –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ç—Ä—ë—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (–º–æ–±–∏–ª—å–Ω—ã–π/–¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π WebView, –≤–µ–±)

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ò–≥—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É –Ω–∞ —Ç—Ä—ë—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö:
1. **–ú–æ–±–∏–ª—å–Ω—ã–π Telegram WebView** ‚Äî –∫–∞—Ä—Ç—ã –ø–ª–æ—Ç–Ω–æ –ø—Ä–∏–ª–µ–≥–∞—é—Ç –∫ –∫—Ä–∞—è–º, –≤—Å—ë —Ö–æ—Ä–æ—à–æ
2. **–î–µ—Å–∫—Ç–æ–ø–Ω—ã–π Telegram WebView** ‚Äî –∫–∞—Ä—Ç—ã –º–µ–ª–∫–∏–µ, –º–Ω–æ–≥–æ –ø—É—Å—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–æ –±–æ–∫–∞–º
3. **–í–µ–± (–±—Ä–∞—É–∑–µ—Ä)** ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—ã—Å–æ—Ç–æ–π, —Å—Ç–æ–ø–∫–∏ –Ω–µ –≤–ª–µ–∑–∞–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞**: 
–†–∞–∑–Ω—ã–µ aspect ratio –∏ —Ä–∞–∑–º–µ—Ä—ã viewport:
- –ú–æ–±–∏–ª—å–Ω—ã–π: —É–∑–∫–∏–π –∏ –≤—ã—Å–æ–∫–∏–π (aspect ~0.5)
- –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π WebView: —à–∏—Ä–æ–∫–∏–π, –Ω–æ –Ω–µ —Ç–∞–∫–æ–π –≤—ã—Å–æ–∫–∏–π (aspect ~0.6-0.8)
- –í–µ–±: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞

–ò—Å—Ö–æ–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ `useGameScale.ts` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ**: 
–í `useGameScale.ts` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è `isWideDesktop`:
```typescript
const aspectRatio = width / height;
const isWideDesktop = aspectRatio > 0.55 && aspectRatio < 0.85 && width > 400;

if (isWideDesktop) {
  // –£–º–µ–Ω—å—à–∞–µ–º reservedHeight —á—Ç–æ–±—ã –¥–∞—Ç—å –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –∫–∞—Ä—Ç–∞–º
  reservedHeight = 250; // –≤–º–µ—Å—Ç–æ 360 –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è**:
```typescript
const AD_SPACE = 52;           // –ú–µ—Å—Ç–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã —Å–≤–µ—Ä—Ö—É
const PROGRESS_BAR = 36;       // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–≤—ë–∑–¥
const EVENTS_ROW = 44;         // –†—è–¥ –∏–∫–æ–Ω–æ–∫ —Å–æ–±—ã—Ç–∏–π
const BOTTOM_BUTTONS = 64;     // –ö–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É (Hint, Undo, Menu)
const PADDING = 16;            // –û—Ç—Å—Ç—É–ø—ã
```

**–§–∞–π–ª—ã**: `client/src/hooks/useGameScale.ts`
**–í–µ—Ä—Å–∏–∏**: 4.99.33 - 4.99.37

**–í–∞–∂–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**:
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞—Å—á—ë—Ç `reservedHeight`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –í–°–ï–• —Ç—Ä—ë—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö:
  - –ú–æ–±–∏–ª—å–Ω—ã–π Telegram: —á–µ—Ä–µ–∑ BotFather ‚Üí WebApp
  - –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π Telegram: —á–µ—Ä–µ–∑ Desktop –∫–ª–∏–µ–Ω—Ç
  - –í–µ–±: –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `console.log` —Å `üéÆ Game Scale:` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞–∑–º–µ—Ä–æ–≤

---

## [2025-02] Daily Quests –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è ‚Äî Race Condition —Å localStorage

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–±–µ–¥—ã –æ–∫–Ω–æ Daily Quests –æ—Ç–∫—Ä—ã–≤–∞–ª–æ—Å—å, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (current: 0 –≤–º–µ—Å—Ç–æ 1). –í –ª–æ–≥–∞—Ö –±—ã–ª–æ –≤–∏–¥–Ω–æ:
```
14:36:28,796 - DailyQuests OPENING - localStorage: current:0
14:36:28,797 - updateDailyQuestsOnWin - saving: current:1
```
DailyQuests —á–∏—Ç–∞–ª –¥–∞–Ω–Ω—ã–µ –Ω–∞ 1–º—Å –†–ê–ù–¨–®–ï —á–µ–º –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å.

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

1. **Stale Closure** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ 4.99.27):
   - `updateDailyQuestsOnWin` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `callbacks.dailyQuests` –Ω–∞–ø—Ä—è–º—É—é
   - –†–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ functional update: `setDailyQuests(prev => ...)`

2. **React setState –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** (–æ—Å—Ç–∞–≤—à–∞—è—Å—è –ø—Ä–æ–±–ª–µ–º–∞):
   - –î–∞–∂–µ —Å functional update, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –í–ù–£–¢–†–ò —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –≤ `setDailyQuests`
   - React –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - `proceedToDailyQuests` ‚Üí `openDailyQuests` –≤—ã–∑—ã–≤–∞–ª–∏—Å—å –î–û —Ç–æ–≥–æ –∫–∞–∫ React –≤—ã–ø–æ–ª–Ω–∏–ª functional update

3. **DailyQuests —á–∏—Ç–∞–ª –∏–∑ localStorage** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ), –Ω–æ –¥–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ –±—ã–ª–∏ –∑–∞–ø–∏—Å–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ)**:
–°–¥–µ–ª–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ localStorage **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º** ‚Äî –ü–ï–†–ï–î React state update:

```typescript
const updateDailyQuestsOnWin = useCallback(() => {
  // 1. –ß–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ localStorage (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
  const savedQuests = localStorage.getItem('solitaire_daily_quests');
  const currentQuests = savedQuests ? JSON.parse(savedQuests) : [];
  
  // 2. –û–±–Ω–æ–≤–ª—è–µ–º
  const updatedQuests = currentQuests.map(quest => { ... });
  
  // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –°–ò–ù–•–†–û–ù–ù–û (–¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞)
  localStorage.setItem('solitaire_daily_quests', JSON.stringify(updatedQuests));
  
  // 4. –û–±–Ω–æ–≤–ª—è–µ–º React state (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ localStorage —É–∂–µ –∞–∫—Ç—É–∞–ª–µ–Ω)
  setDailyQuests(updatedQuests);
}, [callbacks]);
```

**–§–∞–π–ª—ã**: 
- `client/src/hooks/useWinFlow.ts`
- `client/src/components/solitaire/DailyQuests.tsx`

**–í–µ—Ä—Å–∏—è**: 4.99.48

**–ü—Ä–∞–≤–∏–ª–æ**: –ï—Å–ª–∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –°–ò–ù–•–†–û–ù–ù–û –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏—è.

---

## [2025-02] –ö–∞—Ä—Ç–∞ –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É—é—â–µ–π—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∫–ª–∏–∫–∞

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É, –æ–Ω–∞ —É–ª–µ—Ç–∞–ª–∞ –≤ foundation/tableau, –Ω–æ –∫–∞—Ä—Ç–∞ –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ü–û–î –Ω–µ–π (–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª–∞—Å—å –ª–∏—Ü–æ–º –≤–≤–µ—Ä—Ö) –Ω–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∞ –Ω–∞ –∫–ª–∏–∫–∏. –ü—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –∫–ª–∏–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –∂–¥–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏.

**–ü—Ä–∏—á–∏–Ω–∞**: 
1. –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è (`faceUp = true`) —Ç–æ–ª—å–∫–æ –≤ `moveCards()` –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `completeCardAnimation()` ‚Äî —Ç.–µ. –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
2. `performCardAction` –ø—Ä–æ–≤–µ—Ä—è–ª `if (!card.faceUp) return` –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∫–ª–∏–∫
3. `movableStartIndex` –∏–º–µ–ª `break;` –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ faceDown –∫–∞—Ä—Ç—ã:
```typescript
for (let i = cards.length - animatingCardsCount - 1; i >= 0; i--) {
  if (cards[i].faceUp) {
    return i;
  }
  break; // <- –ü—Ä–æ–±–ª–µ–º–∞! –ö–∞—Ä—Ç–∞ –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É—é—â–µ–π—Å—è –µ—â—ë faceDown
}
```

**–†–µ—à–µ–Ω–∏–µ**:
1. –í `movableStartIndex` —Å—á–∏—Ç–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É—é—â–µ–π—Å—è –∫–∞–∫ playable –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ faceDown:
```typescript
const cardBelowAnimatingIdx = cards.length - animatingCardsCount - 1;
if (cardBelowAnimatingIdx >= 0) {
  // –≠—Ç–∞ –∫–∞—Ä—Ç–∞ —Å—Ç–∞–Ω–µ—Ç faceUp –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫
  return cardBelowAnimatingIdx;
}
```

2. –í `performCardAction` –¥–æ–±–∞–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç—ã –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É—é—â–µ–π—Å—è:
```typescript
const isCardBelowAnimating = cardIndex === cardBelowAnimatingIdx;
if (!card.faceUp && !isCardBelowAnimating) {
  return; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ù–ï –∫–∞—Ä—Ç–∞ –ø–æ–¥ –∞–Ω–∏–º–∏—Ä—É—é—â–µ–π—Å—è
}
```

**–§–∞–π–ª—ã**: `client/src/components/solitaire/TableauColumn.tsx`
**–í–µ—Ä—Å–∏—è**: 4.99.49

**–í–∞–∂–Ω–æ**: –≠—Ç–æ —É–ª—É—á—à–∞–µ—Ç UX, –ø–æ–∑–≤–æ–ª—è—è –∏–≥—Ä–æ–∫—É –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∞–Ω–∏–º–∞—Ü–∏–π.

---

## [2025-02] –õ–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤"

**–°–∏–º–ø—Ç–æ–º—ã**: 
–ò–≥—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –æ–∫–Ω–æ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤", —Ö–æ—Ç—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ —è–≤–Ω–æ –±—ã–ª –≤–æ–∑–º–æ–∂–µ–Ω —Ö–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3‚ô• –Ω–∞ 4‚ô†).

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ê–ª–≥–æ—Ä–∏—Ç–º `getHint()` –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö 2 –∏ 5 –ø—Ä–æ–ø—É—Å–∫–∞–ª –∫–æ–ª–æ–Ω–∫–∏ –±–µ–∑ –∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç:
```typescript
const faceDownCount = srcColumn.filter(c => !c.faceUp).length;
if (faceDownCount === 0) continue; // <- –ü—Ä–æ–ø—É—Å–∫–∞–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–µ —Ö–æ–¥—ã!
```

–õ–æ–≥–∏–∫–∞ –±—ã–ª–∞: "–∑–∞—á–µ–º –¥–≤–∏–≥–∞—Ç—å –∫–∞—Ä—Ç—É –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É". –ù–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∞ –º–Ω–æ–≥–æ—Ö–æ–¥–æ–≤—ã–µ —Ü–µ–ø–æ—á–∫–∏:
1. –ü–µ—Ä–µ–ª–æ–∂–∏—Ç—å 3‚ô• –Ω–∞ 4‚ô†
2. –û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –∫–æ—Ä–æ–ª—è
3. –ü–µ—Ä–µ–ª–æ–∂–∏—Ç—å –∫–æ—Ä–æ–ª—è ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É

**–†–µ—à–µ–Ω–∏–µ**:
–î–æ–±–∞–≤–ª–µ–Ω **Priority 6** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –í–°–ï–• –≤–æ–∑–º–æ–∂–Ω—ã—Ö tableau-to-tableau —Ö–æ–¥–æ–≤:
```typescript
// Priority 6: ANY valid tableau-to-tableau move
for (let srcCol = 0; srcCol < state.tableau.length; srcCol++) {
  for (let cardIdx = 0; cardIdx < srcColumn.length; cardIdx++) {
    const card = srcColumn[cardIdx];
    if (!card.faceUp) continue;
    
    for (let dstCol = 0; dstCol < state.tableau.length; dstCol++) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –õ–Æ–ë–û–ô –ª–µ–≥–∞–ª—å–Ω—ã–π —Ö–æ–¥, –Ω–µ —Ç–æ–ª—å–∫–æ "–ø–æ–ª–µ–∑–Ω—ã–π"
      if (canPlaceOnTableau(dstTop, card)) {
        set({ hint: { type: 'tableau', cardId: card.id, from: srcCol, to: dstCol } });
        return;
      }
    }
  }
}
```

**–§–∞–π–ª—ã**: `client/src/lib/stores/useSolitaire.tsx`
**–í–µ—Ä—Å–∏—è**: 4.99.47

---

## [2025-02] DungeonDigPopup: —Ç–∞–π–ª—ã –Ω–µ –∫–ª–∏–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≤–µ–Ω—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã**:
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≤–µ–Ω—Ç–∞ Dungeon Dig –∏ –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤–æ–≥–æ, —Ç–∞–π–ª—ã –ø–æ–¥–∑–µ–º–µ–ª—å—è –Ω–µ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ –∫–ª–∏–∫–∏, —Ö–æ—Ç—è –ª–æ–ø–∞—Ç–∫–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã.

**–ü—Ä–∏—á–∏–Ω–∞**:
DungeonDigPopup **–Ω–µ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤ JSX-–¥–µ—Ä–µ–≤–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null` –∫–æ–≥–¥–∞ –Ω–µ–≤–∏–¥–∏–º. Internal state (`exitFoundLock = true`) —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–≤–µ–Ω—Ç–∞. `exitFoundLock` –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å–µ –∫–ª–∏–∫–∏ –ø–æ —Ç–∞–π–ª–∞–º.

**–†–µ—à–µ–Ω–∏–µ**:
–î–æ–±–∞–≤–∏—Ç—å `useEffect` –Ω–∞ `isVisible` –∫–æ—Ç–æ—Ä—ã–π —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç **–≤—Å–µ** internal state:
```typescript
useEffect(() => {
  if (isVisible) {
    setExitFoundLock(false);
    setShowExitFound(false);
    setEntryRevealedFloors(new Set());
    setAdjacentUnlockedFloors(new Set());
    // ... –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ state
  }
}, [isVisible]);
```

**–§–∞–π–ª—ã**: `components/solitaire/DungeonDigPopup.tsx`
**–í–µ—Ä—Å–∏—è**: 5.0.6

**–í–∞–∂–Ω–æ**: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ internal state –≤ DungeonDigPopup ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ —Å–±—Ä–æ—Å –≤ —ç—Ç–æ—Ç useEffect!

---

## [2025-02] DD –æ–≤–µ—Ä–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ pack reward –Ω–∞ 10-–º —ç—Ç–∞–∂–µ

**–°–∏–º–ø—Ç–æ–º—ã**:
–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è 10-–≥–æ —ç—Ç–∞–∂–∞ –ø–æ–¥–∑–µ–º–µ–ª—å—è —Å pack –Ω–∞–≥—Ä–∞–¥–æ–π, –æ–≤–µ—Ä–ª–µ–π "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!" –Ω–µ –ø–æ—è–≤–ª—è–ª—Å—è. –û–∫–Ω–æ –∏–≤–µ–Ω—Ç–∞ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—ã–º –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –µ–≥–æ –∑–∞–∫—Ä—ã—Ç—å.

**–ü—Ä–∏—á–∏–Ω–∞**:
–í `finishPackClaim()` —É—Å–ª–æ–≤–∏–µ `completedFloorIdx === 9 && !completedReward?.packRarity` –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ –æ–≤–µ—Ä–ª–µ–π –∫–æ–≥–¥–∞ 10-–π —ç—Ç–∞–∂ –∏–º–µ–ª pack reward (–ø–æ—Ç–æ–º—É —á—Ç–æ `!packRarity` = false).

**–†–µ—à–µ–Ω–∏–µ**:
1. –ò–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –Ω–∞ –ø—Ä–æ—Å—Ç–æ `completedFloorIdx === 9`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pendingEventComplete` state ‚Äî —Å—Ç–∞–≤–∏—Ç –æ–≤–µ—Ä–ª–µ–π –≤ –æ—á–µ—Ä–µ–¥—å
3. useEffect –∂–¥—ë—Ç `!isPackPopupOpen` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–≤–µ—Ä–ª–µ–π —Å 300ms –∑–∞–¥–µ—Ä–∂–∫–æ–π

```typescript
if (completedFloorIdx === 9) {
  setPendingEventComplete(true); // –ü–æ–∫–∞–∂–µ—Ç—Å—è –ø–æ—Å–ª–µ pack popup
}
```

**–§–∞–π–ª—ã**: `components/solitaire/DungeonDigPopup.tsx`
**–í–µ—Ä—Å–∏—è**: 5.0.6

---

## –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

```
## [–î–ê–¢–ê] –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–°–∏–º–ø—Ç–æ–º—ã**:

**–ü—Ä–∏—á–∏–Ω–∞**:

**–†–µ—à–µ–Ω–∏–µ**:

**–§–∞–π–ª—ã**:
**–í–µ—Ä—Å–∏—è**:
```
